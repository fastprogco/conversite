<div class="card">
  <div class="card-body">
    <%= form_with(model: [@chatbot, @chatbot_step], local: true, class: "needs-validation") do |f| %>
      <%= render "shared_partials/error", model: @chatbot_step %>

      <div class="mb-3">
        <%= f.label :header, class: "form-label" %> <span class="text-danger">Max 60 characters</span>
        <%= f.text_field :header, class: "form-control", required: true, maxlength: 60 %>
      </div>

      <div class="mb-3">
        <%= f.label :description, class: "form-label" %> <span class="text-danger">Max 1024 characters</span>
        <%= f.text_area :description, class: "form-control", rows: 5, required: true, maxlength: 1024 %>
      </div>

      <div class="mb-3">
        <%= f.label :footer, class: "form-label" %> <span class="text-danger">Max 60 characters</span>
        <%= f.text_field :footer, class: "form-control", maxlength: 60 %>
      </div>

      <div class="mb-3">
        <%= f.label :list_button_caption, "List Button Caption", class: "form-label" %> <span class="text-danger">Max 20 characters</span>
        <%= f.text_field :list_button_caption, class: "form-control", maxlength: 20 %>
      </div>

      <div class="mb-3">
        <%= f.label :previous_chatbot_step_id, "Previous Step", class: "form-label" %>
        <%= f.collection_select :previous_chatbot_step_id, 
                              @chatbot.chatbot_steps.where.not(id: @chatbot_step.id), 
                              :id, 
                              :header, 
                              { include_blank: "Select Previous Step" }, 
                              { class: "form-select" } %>
      </div>

      <div class="mb-3">
        <%= f.submit class: "btn btn-primary" %>
        <% if request.path.include?('edit') %>
          <%= link_to "Add Reply Option", "#", class: "btn btn-info", data: { bs_toggle: "modal", bs_target: "#replyOptionModal" } %>
          <%= link_to "Add Multimedia Reply", "#", class: "btn btn-success" %>
          <%= link_to "Back", :back, class: "btn btn-secondary" %>


          <% if @chatbot_step.chatbot_button_replies.where(is_deleted: false).any? %>
            <div class="table-responsive mt-3">
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Order</th>
                    <th>Action Type</th>
                    <th>Added By</th>
                    <th>Added On</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @chatbot_step.chatbot_button_replies.where(is_deleted: false).order(:order).each do |reply| %>
                    <tr>
                      <td><%= reply.title %></td>
                      <td><%= reply.order %></td>
                      <td><%= reply.action_type_id.to_s.humanize %></td>
                      <td><%= reply.added_by&.email %></td>
                      <td><%= reply.added_on&.strftime("%Y-%m-%d %H:%M") %></td>
                      <td>
                        <%= link_to "Edit", edit_chatbot_chatbot_step_chatbot_button_reply_path(@chatbot, @chatbot_step, reply),
                            class: "btn btn-sm btn-warning" %>
                        <%= link_to "Delete", chatbot_chatbot_step_chatbot_button_reply_path(@chatbot, @chatbot_step, reply), 
                            data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
                            class: "btn btn-sm btn-danger" %>
                      </td>
                    </tr>


                  <% end %>
                </tbody>
              </table>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<%= render "chatbot_button_reply_modal", reply_title: "", reply_order: "", reply_action_type: "", reply_modal_id: "replyOptionModal", endpoint: nil %>